---
name: Markdown Exporter
status: open
created: 2025-12-29T12:52:49Z
updated: 2025-12-29T13:07:25Z
assigned_agent: .claude/agents/languages/python-backend-engineer.md
agent_context:
  framework: none
  language: python
  approach: markdown generation with date grouping
github: https://github.com/rafeekpro/telegram-chat-getter/issues/8
depends_on: [6, 7]
parallel: false
conflicts_with: []
---

# Task: Markdown Exporter

## Description
Convert downloaded messages to a readable Markdown format. Group messages by date, include sender information, timestamps, and link to downloaded media files.

## TDD Requirements
**This project uses Test-Driven Development. You MUST:**
1. RED: Write failing test first
2. GREEN: Write minimal code to make test pass
3. REFACTOR: Clean up code while keeping tests green

See `.claude/rules/tdd.enforcement.md` for complete requirements.

## Acceptance Criteria
- [ ] Generate `messages.md` file
- [ ] Include chat metadata header
- [ ] Group messages by date (sections)
- [ ] Show time and sender for each message
- [ ] Link to media files using relative paths
- [ ] Handle reply messages (show "replying to...")
- [ ] Generate `metadata.json` with download stats

## Technical Details

### Output Format (messages.md)
```markdown
# Chat: Work Team
Downloaded: 2025-01-15T14:30:00Z
Total messages: 1234
Media files: 56

---

## 2025-01-15

### 14:30 - John Doe
Hello everyone! Check out this update.

### 14:31 - Jane Smith
> Replying to John Doe

Thanks for sharing!

### 14:32 - John Doe
Here's the presentation:
![image](media/images/2025-01-15_001.jpg)

### 14:35 - Jane Smith
[Voice message](media/audio/2025-01-15_001.ogg)

### 14:40 - Mike Johnson
[Document: report.pdf](media/documents/report.pdf)

---

## 2025-01-14

### 09:15 - Jane Smith
Good morning!
```

### Metadata JSON
```json
{
  "chat_name": "Work Team",
  "chat_id": 123456789,
  "chat_type": "group",
  "downloaded_at": "2025-01-15T14:30:00Z",
  "total_messages": 1234,
  "media_files": {
    "images": 23,
    "audio": 12,
    "video": 5,
    "documents": 16
  },
  "date_range": {
    "from": "2024-01-01",
    "to": "2025-01-15"
  }
}
```

### Exporter Implementation
```python
from datetime import datetime
from collections import defaultdict

def export_to_markdown(
    messages: list[Message],
    chat_name: str,
    output_dir: Path,
) -> None:
    """Export messages to Markdown file."""
    # Group by date
    by_date = defaultdict(list)
    for msg in messages:
        date_key = msg.date.strftime("%Y-%m-%d")
        by_date[date_key].append(msg)

    # Generate markdown
    md = f"# Chat: {chat_name}\n"
    md += f"Downloaded: {datetime.utcnow().isoformat()}Z\n"
    md += f"Total messages: {len(messages)}\n\n"
    md += "---\n\n"

    for date in sorted(by_date.keys(), reverse=True):
        md += f"## {date}\n\n"
        for msg in sorted(by_date[date], key=lambda m: m.date):
            md += format_message(msg)
        md += "---\n\n"

    (output_dir / "messages.md").write_text(md)
```

## Dependencies
- [ ] Task 004: Message Downloader (for message data)
- [ ] Task 005: Media Downloader (for media file paths)

## Effort Estimate
- Size: S
- Hours: 3
- Parallel: false

## Definition of Done
- [ ] Tests written FIRST (RED phase)
- [ ] Code implemented (GREEN phase)
- [ ] Code refactored (REFACTOR phase)
- [ ] All tests passing
- [ ] Markdown file is readable and well-formatted
- [ ] Media links work correctly
- [ ] Metadata JSON is accurate
- [ ] Date grouping is correct
