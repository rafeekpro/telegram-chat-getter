---
name: Authentication Module
status: open
created: 2025-12-29T12:52:49Z
updated: 2025-12-29T12:52:49Z
assigned_agent: .claude/agents/languages/python-backend-engineer.md
agent_context:
  framework: telethon
  language: python
  approach: async telegram client with session persistence
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: Authentication Module

## Description
Implement the Telegram Client API authentication flow using Telethon. Handle phone number verification, code input, and session persistence for future connections.

## TDD Requirements
**This project uses Test-Driven Development. You MUST:**
1. RED: Write failing test first
2. GREEN: Write minimal code to make test pass
3. REFACTOR: Clean up code while keeping tests green

See `.claude/rules/tdd.enforcement.md` for complete requirements.

## Acceptance Criteria
- [ ] Load API_ID and API_HASH from environment variables
- [ ] Prompt user for phone number on first auth
- [ ] Handle Telegram verification code input
- [ ] Save session file for reuse (`.session` file)
- [ ] Reconnect using existing session without re-auth
- [ ] Handle 2FA password if enabled
- [ ] Graceful error handling for invalid credentials

## Technical Details

### auth.py Implementation
```python
from telethon import TelegramClient
from telethon.sessions import StringSession
import os
from dotenv import load_dotenv

class TelegramAuth:
    def __init__(self, session_file: str = "telegram_getter"):
        load_dotenv()
        self.api_id = os.getenv("TELEGRAM_API_ID")
        self.api_hash = os.getenv("TELEGRAM_API_HASH")
        self.session_file = session_file
        self.client = None

    async def connect(self) -> TelegramClient:
        """Connect to Telegram, authenticate if needed."""
        self.client = TelegramClient(
            self.session_file,
            self.api_id,
            self.api_hash
        )
        await self.client.start()
        return self.client

    async def disconnect(self):
        """Disconnect from Telegram."""
        if self.client:
            await self.client.disconnect()
```

### CLI Integration (auth command)
```bash
python -m telegram_getter auth
# Prompts for phone number and code
# Saves session for future use
```

### Session Storage
- Session saved as `telegram_getter.session` in current directory
- Contains encrypted auth key (safe to commit to .gitignore)

## Dependencies
- [ ] Task 001: Project Setup (for package structure and dependencies)

## Effort Estimate
- Size: M
- Hours: 4
- Parallel: false

## Definition of Done
- [ ] Tests written FIRST (RED phase)
- [ ] Code implemented (GREEN phase)
- [ ] Code refactored (REFACTOR phase)
- [ ] All tests passing
- [ ] Can authenticate with phone + code
- [ ] Session persists between runs
- [ ] Error messages are user-friendly
