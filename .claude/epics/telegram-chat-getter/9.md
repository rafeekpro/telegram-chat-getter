---
name: CLI Integration and Testing
status: open
created: 2025-12-29T12:52:49Z
updated: 2025-12-29T13:07:25Z
assigned_agent: .claude/agents/languages/python-backend-engineer.md
agent_context:
  framework: argparse
  language: python
  approach: cli with rich progress bars and comprehensive tests
github: https://github.com/rafeekpro/telegram-chat-getter/issues/9
depends_on: [5, 6, 7, 8]
parallel: false
conflicts_with: []
---

# Task: CLI Integration and Testing

## Description
Wire up all components into a cohesive CLI application. Implement argparse commands, add rich progress bars, and write comprehensive tests for all modules.

## TDD Requirements
**This project uses Test-Driven Development. You MUST:**
1. RED: Write failing test first
2. GREEN: Write minimal code to make test pass
3. REFACTOR: Clean up code while keeping tests green

See `.claude/rules/tdd.enforcement.md` for complete requirements.

## Acceptance Criteria
- [ ] `auth` command authenticates with Telegram
- [ ] `list` command shows all chats
- [ ] `download` command downloads chat with all options
- [ ] `--output` option specifies output directory
- [ ] `--from` and `--to` options filter by date
- [ ] `--no-media` option skips media download
- [ ] Rich progress bars for download operations
- [ ] Comprehensive test suite with >80% coverage

## Technical Details

### CLI Commands
```bash
# Authentication
python -m telegram_getter auth

# List chats
python -m telegram_getter list
python -m telegram_getter list --groups

# Download chat
python -m telegram_getter download "Chat Name"
python -m telegram_getter download --id 123456789
python -m telegram_getter download "Chat Name" --output ./backup
python -m telegram_getter download "Chat Name" --from 2025-01-01 --to 2025-01-31
python -m telegram_getter download "Chat Name" --no-media
```

### cli.py Implementation
```python
import argparse
import asyncio
from rich.console import Console
from rich.progress import Progress

console = Console()

def main():
    parser = argparse.ArgumentParser(
        prog="telegram-getter",
        description="Download Telegram chat history"
    )
    subparsers = parser.add_subparsers(dest="command", required=True)

    # Auth command
    subparsers.add_parser("auth", help="Authenticate with Telegram")

    # List command
    list_parser = subparsers.add_parser("list", help="List available chats")
    list_parser.add_argument("--groups", action="store_true")
    list_parser.add_argument("--private", action="store_true")
    list_parser.add_argument("--channels", action="store_true")

    # Download command
    dl_parser = subparsers.add_parser("download", help="Download a chat")
    dl_parser.add_argument("chat", nargs="?", help="Chat name")
    dl_parser.add_argument("--id", type=int, help="Chat ID")
    dl_parser.add_argument("--output", "-o", default="output")
    dl_parser.add_argument("--from", dest="from_date", type=str)
    dl_parser.add_argument("--to", dest="to_date", type=str)
    dl_parser.add_argument("--no-media", action="store_true")

    args = parser.parse_args()
    asyncio.run(run_command(args))
```

### Progress Display
```python
with Progress() as progress:
    task = progress.add_task("Downloading messages...", total=message_count)
    async for msg in download_messages(client, chat):
        progress.update(task, advance=1)
        # process message
```

### Test Coverage
- `tests/test_auth.py` - Authentication tests
- `tests/test_list.py` - List command tests
- `tests/test_downloader.py` - Message download tests
- `tests/test_media.py` - Media download tests
- `tests/test_exporter.py` - Markdown export tests
- `tests/test_cli.py` - CLI integration tests

## Dependencies
- [ ] Task 003: List Chats (for list command)
- [ ] Task 004: Message Downloader (for download logic)
- [ ] Task 005: Media Downloader (for media handling)
- [ ] Task 006: Markdown Exporter (for output generation)

## Effort Estimate
- Size: M
- Hours: 4
- Parallel: false

## Definition of Done
- [ ] Tests written FIRST (RED phase)
- [ ] Code implemented (GREEN phase)
- [ ] Code refactored (REFACTOR phase)
- [ ] All tests passing with >80% coverage
- [ ] All CLI commands work correctly
- [ ] Progress bars display properly
- [ ] Error handling provides helpful messages
- [ ] README with usage examples
